<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Achievements Admin</title>
<style>
  body { font-family: sans-serif; max-width: 600px; margin: 50px auto; background:#070b14; color:#e6ebff; }
  input, textarea, button { width: 100%; margin-bottom: 10px; padding: 10px; border-radius:5px; border:none; }
  button { cursor:pointer; background:#6ea8ff; color:#070b14; font-weight:600; }
  button:hover { background:#4d8dff; color:white; }
  #login-section, #form-section { margin-top:20px; background:#0e1424; padding:20px; border-radius:10px; }
</style>
</head>
<body>

<h2>Achievements Admin</h2>

<!-- LOGIN SECTION -->
<div id="login-section">
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- FORM SECTION -->
<div id="form-section" style="display:none;">
  <input id="title" placeholder="Title">
  <input id="date" type="date">
  <textarea id="desc" placeholder="Description"></textarea>
  <input type="file" id="image"><br>
  <button onclick="addAchievement()">Add Achievement</button>
</div>

<script>
  // ===== CONFIG =====
  const ADMIN_USER = "admin";
  const ADMIN_PASS = "1234";  // Change this
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwoL50mUUsY-zMd0O-Q2464TzWKYBW07CwPF9rS9Xx5zu6RLh6V4S4JTj5cKqI3ktYa/exec"; 

  // ===== LOGIN =====
  function login() {
    const user = document.getElementById("username").value;
    const pass = document.getElementById("password").value;
    if(user === ADMIN_USER && pass === ADMIN_PASS){
      alert("Login Successful!");
      document.getElementById("login-section").style.display="none";
      document.getElementById("form-section").style.display="block";
    } else {
      alert("Invalid username or password!");
    }
  }

  // ===== ADD ACHIEVEMENT =====
  async function addAchievement() {
    const title = document.getElementById("title").value;
    const date = document.getElementById("date").value;
    const desc = document.getElementById("desc").value;
    const fileInput = document.getElementById("image");
    const file = fileInput.files[0];

    if(!title || !date || !desc || !file){
      alert("Fill all fields!");
      return;
    }

    const reader = new FileReader();
    reader.onload = async function(){
      const base64 = reader.result.split(",")[1]; // remove prefix

      const formData = new FormData();
      formData.append("title", title);
      formData.append("date", date);
      formData.append("description", desc);
      formData.append("fileBase64", base64);
      formData.append("fileName", file.name);
      formData.append("fileType", file.type);

      try {
        const res = await fetch(WEB_APP_URL, {
          method: "POST",
          body: formData,
        });

        const data = await res.json();
        if(data.status === "success"){
          alert("Achievement added!\nImage URL: " + data.imageUrl);
          document.getElementById("title").value="";
          document.getElementById("date").value="";
          document.getElementById("desc").value="";
          fileInput.value="";
        } else {
          alert("Error: " + data.message);
        }

      } catch(err){
        alert("Failed to connect to Web App: " + err.message);
      }
    }

    reader.readAsDataURL(file);
  }
</script>

</body>
</html>
